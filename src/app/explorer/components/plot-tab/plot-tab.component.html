

<div *ngIf="plotSelectors.isPlotEmpty$ | async">
  <p class="empty-plot"><fa-icon [icon]="['fas', 'chart-line']" size="2x"></fa-icon></p>
  <p class="lead empty-plot"> no elements plotted</p>
</div>

<!-- Left Axis -->
<div *ngIf="(plotSelectors.leftElements$ | async)?.length>0">
  <div class="row justify-content-between section-title top lead no-gutters">
      <div class="col">
        <!-- Expand/Collapse Axis Settings-->
        <fa-icon [icon]="(plotSelectors.showLeftAxisSettings$|async)?['fas','caret-down']:['fas','caret-right']" 
          size="lg" class="icon-expand" 
          (click)="plotService.toggleLeftAxisSettings()"></fa-icon>
        Left Axis
      </div>
      <div class="col">
          <!-- Autoscale Axis-->
          <button class="btn autoscale"
            (click)="plotService.autoScaleAxis('left')">
            <fa-icon [icon]="['fas', 'arrows-alt-v']"  [fixedWidth]="true"></fa-icon> auto </button>
      </div>
    </div>
  </div>
  <!-- only shown if axis settings are displayed -->
  <div @slideUpDown *ngIf="(plotSelectors.showLeftAxisSettings$ | async)">
    <app-axis-settings
      [settings]="plotSelectors.leftAxisSettings$ | async" 
      [yaxis-settings]="true"  
      (changed)="plotService.setLeftAxisSettings($event)"></app-axis-settings>
    
  </div>
  <app-plotted-elements
    class="plotted-element"
    *ngFor="let element of plotSelectors.leftElements$ | async;"
    [element]="element"
    [axis]="'left'">
  </app-plotted-elements>
<div>




<!-- Right Axis -->
<div *ngIf="(plotSelectors.rightElements$ | async)?.length>0">
  <div class="row justify-content-between section-title lead no-gutters">
    <div class="col">
      <!-- Expand/Collapse Axis Settings-->
      <fa-icon [icon]="(plotSelectors.showRightAxisSettings$|async)?['fas','caret-down']:['fas','caret-right']" 
        size="lg" class="icon-expand" 
        (click)="plotService.toggleRightAxisSettings()"></fa-icon>
      Right Axis
    </div>
    <div class="col">
        <!-- Autoscale Axis-->
        <button class="btn btn-primary autoscale"
          (click)="plotService.autoScaleAxis('right')">
          <fa-icon [icon]="['fas', 'arrows-alt-v']"  [fixedWidth]="true"></fa-icon> auto </button>
    </div>
  </div>
  <!-- only shown if axis settings are displayed -->
  <div @slideUpDown *ngIf="(plotSelectors.showRightAxisSettings$ | async)">
    <app-axis-settings *ngIf="(plotSelectors.rightElements$ | async)?.length>0" 
      [settings]="plotSelectors.rightAxisSettings$ | async"
      [yaxis-settings]="true"
      (changed)="plotService.setRightAxisSettings($event)"></app-axis-settings>
    
  </div>
  <app-plotted-elements 
    class="plotted-element"
    *ngFor="let element of plotSelectors.rightElements$ | async"
    [element]="element"
    [axis]="'right'">
  </app-plotted-elements>
</div>



<!-- Time Axis -->
<div class="row justify-content-between section-title lead no-gutters">
  <div class="col">
    <!-- Expand/Collapse Axis Settings-->
    <fa-icon [icon]="(plotSelectors.showTimeAxisSettings$|async)?['fas','caret-down']:['fas','caret-right']" 
      size="lg" class="icon-expand" 
      (click)="plotService.toggleTimeAxisSettings()"></fa-icon>
    Time Axis
  </div>
  <div class="col">
    <!-- Autoscale Axis-->
    <button class="btn btn-primary autoscale" (click)="plotService.autoScaleTime()">
      <fa-icon [icon]="['fas', 'arrows-alt-h']"  [fixedWidth]="true"></fa-icon> auto
    </button>
  </div>
</div>
<div @slideUpDown
  *ngIf="(plotSelectors.showTimeAxisSettings$ | async)">
  <app-axis-settings 
      [settings]="plotSelectors.timeAxisSettings$ | async"
      [yaxis-settings]="false"
      (changed)="plotService.setTimeAxisSettings($event)">
  </app-axis-settings>
</div>

<!-- Plot Annotations -->
<div class="row justify-content-between section-title lead no-gutters">
  <div class="col">
    Annotations
  </div>
  <div class="col">
    <!-- Start Annotating -->
    <button class="btn btn-primary autoscale"
      *ngIf="!(annotationSelectors.enabled$ | async)"
      [disabled]="measurementSelectors.enabled$ | async"
      (click)="annotationUIService.startAnnotation()">
      <fa-icon [icon]="['fas', 'plus']"  [fixedWidth]="true"></fa-icon> create 
    </button>
    <!-- Stop Annotating -->
    <button class="btn btn-danger exit-annotation"
      *ngIf="annotationSelectors.enabled$ | async"
      (click)="annotationUIService.cancelAnnotation()">
      exit
    </button>
    <!-- Hide Annotation -->
    <button class="btn btn-danger hide-annotation"
      *ngIf="(annotationSelectors.selectedAnnotationId$ | async) != null"
      (click)="annotationUIService.hideAnnotation()">
      hide
    </button>

  </div>
</div>
<!-- Annotation instructions -->
<div *ngIf="annotationSelectors.enabled$ | async" class="annotation-instructions">
  click or drag on plot to annotate <fa-icon [icon]="['fas', 'arrow-right']"></fa-icon> 

</div>
<div class="filter-annotations">
  <span class="ml-4">Search: </span>
  <input [(ngModel)]="filterText" (ngModelChange)="filterChanged($event)"
    type="text" class="ml-1" placeholder="filter">
</div>

<div *ngFor="let block of annotationMap$ | async" >
  <div class="annotated-stream">
      <fa-icon [icon]="['fas', 'database']"></fa-icon> {{block.stream.path}}
      <fa-icon [icon]="['fas', 'sync-alt']" class="icon-button refresh"
        *ngIf="!block.stream.refreshing_annotations"
        (click)="annotationService.reloadAnnotations(block.stream.id)"></fa-icon>
      <fa-icon [icon]="['fas', 'sync-alt']" [spin]="true" class="refreshing" 
        *ngIf="block.stream.refreshing_annotations"></fa-icon>

  </div>
  <div *ngIf="block.annotations.length==0" class="no-annotations">none</div>
  <div 
    *ngFor="let annotation of block.annotations | annotationFilter: filterText" class="annotation"
    (click)="annotationUIService.selectAnnotation(annotation)"
    class = "annotation"
    [ngClass]="{selected: (annotationSelectors.selectedAnnotationId$ | async) == annotation.id}">
    <span class="annotation-date">{{annotation.start | date:'HH:mm MMM d, y'}}</span>
    <span [innerHTML]="annotation.title | highlightFilter : filterText"></span>
    <fa-icon [icon]="['fas', 'trash-alt']" class="float-right delete"
        (click)="deleteAnnotation($event, annotation)"></fa-icon>
  </div>
</div>